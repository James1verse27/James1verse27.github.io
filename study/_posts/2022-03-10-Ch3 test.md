---
layout: post
title:  "[의학통계학방법론] Ch3. Measures of Central Tendency"
category: Study
tag: [R, SAS, blog, jekyll, Jupyter, Data, Python]
toc: true
author_profile: false
---
* this unordered seed list will be replaced by the toc
{:toc}

- 뒤로가기를 누르시면 목차로 되돌아옵니다.


# Measures of Central Tendency

## 3.1 The Arithmetic Mean

* 자료
    - 양적 자료: 이산형, 연속형
    - 질적 자료: 명목형, 순서형<br/><br/>
* 측정 (measurement) 이란?<br/>
    (일정한 규칙에 의해 대상, 사건, 상태의 특성에 숫자를 부여하는 것)
    - 위치 측도 (measures of location)
    - 산포 측도 (measures of spread)
    - 신뢰도 측도 (measures of reliability)<br/><br/>
* 측정 척도(scale of measure; level of measurement)<br/>
  (일정한 규칙에 의해 부여된 수치들의 내재적 특성을 설명하기 위한 분류)<br/>
    - 질적 척도: 명목척도, 서열척도(=순위척도)
    - 양적 척도: 구간척도(=등간척도), 비척도<br/><br/>
* 질적 데이터 (qualitative data): 크기나 양적 차이 구분이 불가능
    - 명목척도(nominal scale): 속성의 유무만을 나타내며 양적 크기는 못 나타낸다.
        - 생사여부, 성별, 치료 여부
        - 질병 상태, 결혼 상태
        - 혈액형
        - 직종
    - 서열척도 (ordinal scale): 만족도, 행복 정도, 불쾌 지수 같이 비수치형으로 순서성만 나타낸다.
        - 중증도
        - 출생서열: 첫째, 둘째, 셋째 등
        - 5정 리커트 척도
        - 암의 병기(stage): I, II, III, 또는 IV
    - 통계분석을 위해 질적 데이터는 통상적으로 서로 다른 값으로 코딩 한 후 빈도 측정함으로써 이산형 숫자로 변환된다.<br/><br/>
* 양적 데이터 (quantitative data): 크기나 양적 차이 구분이 가능
    - 구간척도(interval scale): 구간척도(=등간척도)는 절대 O(true zero)이 없음. 간격이 일정함.
        - 체온
        - 각종 지수(index) 
        - 일，월，년
    - 비척도(ratio scale): 비척도는 절대 0이 있으며 크기의 비교가 가능하여 수의 사칙연산 적용 가능함.
        - 이산형 (numerical discrete)
            - 임신 회수(parity)，사망자 수(number of deaths)
            - 매년 한국에서 AIDS에 걸리는 새로운 환자 수(counts) 
            - 자녀 수
        - 연속형 (numerical continuous)
            - 체중, 결혼 연령
            - 생존시간 
            - 혈압
            - 중량, 부피, 용량, 비율, 길이 등<br/>
- **보충**
    - 비 （ratio）
        - 측정 단위가 같은 두 개 값 간의 상대적 크기를 비교한 것 （예: A:B） 
        - 분자와 분모가 서로 독립적인 관계로 서로 다른 범주일 때 사용
        - A에 대한 B의 비는 B/A로 계산 됨.<br/>예） 성비, 인구밀도（인구/면적） 등이 비에 해당됨<br/>남자:여자 = 60:40 （명）
    - 비율 （proportion）
        - 전체를 1로 보았을 때 한 항목이 차지하는 값
        - 비의 특수한 형태로 분모에 분자가 포함됨.<br/>예） 전체 미혼자 중 남자 미혼자의 비율<br/>남자 미혼자/（남자 미혼자 + 여자 미혼자）.
    - 백분율 （percent）
        - 전체를 100으로 보았을 때 한 항목이 차지하는 값 
        - 백분율 = 비율 x 100
    - 율 （rate）
        - 모집단의 구성원 수 중 사건의 수로 표현함
        - 서로 측정 단위가 다른 두 수치 간의 비（ratio) 임.
        

## 1.2 Accuracy and Significant Figures

- 정확도와 정밀도 (accuracy and precision) 
    - 정확도 (accuracy)
        - 측정되는 변수의 참값에 가깝게 측정되고 있는 정도를 나타낸 것.<br/>The nearness of a measurement to the true value of the variable being measured.<br/>(측정의 정확성)
    - 정밀도(precision)
        - 같은 양을 반복측정할 때 매번의 측정값들이 비슷하게 측정되고 있는 정도를 나타낸 것.<br/>It’s not a synonymous term but refers to the closeness to each other of repeated measurements of the same quantity (측정의 재현성)

## 1.3 Frequency Distributions

- 연속형 자료를 범주화 할 땐 범주를 명확하게 표시해야한다.
- 빈도분포를 살펴봄으로 이질적인 자료가 모인 것은 아닌지 예상한다.<br/>이봉분포시 이질적인 자료가 모인 것으로 예상한다.<br/>ex) 수술자가 다르다면 수술자 정보를 알아야 한다.

## 1.4 Cumulative Frequency Dstributions

- Cumulative Frequency Dstributions는 중위수, 백분위수 및 기타 분위수를 결정하는데 유용하다.<br/><br/>
- **데이터를 살펴볼 때**
    - 데이터 분포의 모양, 형태를 살피기
    - 데이터의 중심 위치파악
    - 명목척도일 경우 최빈값을 이용
    - 분포가 대칭이고 극단값이 없는 경우 산술평균이나 중위수 모두 이용 
    - 분포가 비대칭이고 극단값이 있는 경우 중위수를 대표값으로 선택하고 산술평균을 보조적으로 제시 
    - 순위척도일 경우 중위수를 대표값으로 이용
    - 데이터의 범위파악
    - 분포의 형태는 어떠한가?<br/>예: 정규분포, 이봉 분포(bimodal distribution), 지수분포, 치우친분포(skewed distribution) 등.<br/>대칭/비대칭 - 왜도<br/>뾰족한가/완만한가 - 첨도
    - 이상치 (outlier)들이 있는가?
    - 데이터 값들 중 비상식적으로 이상한 값이 존재하는가?
    - 정보의 약 90%는 그래프에 포함되어 있다고 한다.
    - 통계학의 첫째 규칙 : 상식을 이용하기

<br/>

# R 프로그램 결과

<details>
<summary>
R 접기/펼치기 버튼
</summary>
<div markdown="1">

**패키지**
<details>
<summary>
설치된 패키지 접기/펼치기 버튼
</summary>

<div markdown="1">

``` r
getwd()
```

    ## [1] "C:/Biostat"

``` r
install.packages("readxl")
install.packages('ggplot2')
install.packages("Hmisc")
install.packages("psych")
```


</div>
</details>

**엑셀파일불러오기**

``` r
library('readxl')
#모든 시트를 하나의 리스트로 불러오는 함수
read_excel_allsheets <- function(file, tibble = FALSE) {
  sheets <- readxl::excel_sheets(file)
  x <- lapply(sheets, function(X) readxl::read_excel(file, sheet = X))
  if(!tibble) x <- lapply(x, as.data.frame)
  names(x) <- sheets
  x
}
```

</div>
</details>

## 3장

**3장 연습문제 불러오기**

``` r
data_chap03 <- read_excel_allsheets("data_chap03.xls")

for (x in 1:length(data_chap03)){
  assign(paste0('ex3_',1:length(data_chap03))[x],data_chap03[x])
  }
for (x in 1:length(data_chap03)){
  assign(paste0('ex3_',1:length(data_chap03))[x],data.frame(data_chap03[x]))
  }
```

### EXAMPLE 3.1

![](/study/img/ch3/3-1.png)

``` r
#데이터셋
ex3_1
```

    ##    Length
    ## 1     3.3
    ## 2     3.5
    ## 3     3.6
    ## 4     3.6
    ## 5     3.7
    ## 6     3.8
    ## 7     3.8
    ## 8     3.8
    ## 9     3.9
    ## 10    3.9
    ## 11    3.9
    ## 12    4.0
    ## 13    4.0
    ## 14    4.0
    ## 15    4.0
    ## 16    4.1
    ## 17    4.1
    ## 18    4.1
    ## 19    4.2
    ## 20    4.2
    ## 21    4.3
    ## 22    4.3
    ## 23    4.4
    ## 24    4.5

``` r
sum_x <- sum(ex3_1$Length) ; cat('Sum of X =', sum_x)
```

    ## Sum of X = 95

``` r
n <- length(ex3_1$Length); cat('Sample Size =', n)
```

    ## Sample Size = 24

``` r
x_bar <- mean(ex3_1$Length); cat('Mean of X =', x_bar)
```

    ## Mean of X = 3.958333

$$
\\begin{aligned}
\\sum X_i &= 95.0 \\ cm \\\\
n &= 24 \\\\
\\bar{X} &= \\frac{\\sum X_i}{n} = \\frac{95.0\\ cm}{24} = 3.96\\ cm 
\\end{aligned}
$$

-   나비의 날개 길이를 측정하기 위해 추출된 24마리의 나비들을 관측한
    결과,<br/> 날개의 합은 95 cm 이며 평균은 3.96 cm 이다.

### EXAMPLE 3.2

![](/study/img/ch3/3-2.png)

``` r
#데이터셋
ex3_2
```

    ##    exam3_2.X exam3_2.Freq
    ## 1        3.3            1
    ## 2        3.4            0
    ## 3        3.5            1
    ## 4        3.6            2
    ## 5        3.7            1
    ## 6        3.8            3
    ## 7        3.9            3
    ## 8        4.0            4
    ## 9        4.1            3
    ## 10       4.2            2
    ## 11       4.3            2
    ## 12       4.4            1
    ## 13       4.5            1

-   **가중평균 계산**

``` r
library(Hmisc) # wtd.mean 사용하기 위해
xi <- ex3_2$exam3_2.X
fi <- ex3_2$exam3_2.Freq
wm <- wtd.mean(xi, weights=fi) #가중평균
round(wm,2)
```

    ## [1] 3.96

-   도수분포표에서 가중평균을 구할 때에는 각 표본에 가중을 두어 합을
    구한 후 가중치의 합을 나눈다.

``` r
sum_fixi <- sum(fi*xi) # 가중합
sum_fi <- sum(fi) #가중치 합
w_mean<-sum_fixi/sum_fi #가중평균
cat("가중합 = ",sum_fixi,"   ","가중치 합 = ",sum_fi,"   ","가중평균 = ",w_mean)
```

    ## 가중합 =  95     가중치 합 =  24     가중평균 =  3.958333

$$
\\begin{aligned}
\\overline X_w &= \\frac {\\sum\_{i=1}^{n}f_i \\cdot X_i} {\\sum\_{i=1}^{n}f_i} =  \\frac{95.0 cm}{24} = 3.96
\\end{aligned}
$$
<br/> <br/>

-   **중위수 계산**<br/>중위수는 정렬된 자료에서 중앙에 위치한
    수이다.<br/>도수분포표에서는 R에 내장되어 있는 함수인 wtd.quantile()
    함수를 사용해서 중위수를 구할 수 있다.

``` r
x.median <- wtd.quantile(xi, weights=fi, probs=c(0,.25,.5,.75,1), type=c("i/n"))
wmed <- round(x.median,5)
wvar <- wtd.var(xi, weights=fi) # 분산
cat("wtd.quatile() 로 구한 중위수","\n","중위수 = ",wmed[3],"   분산 = ",wvar)
```

    ## wtd.quatile() 로 구한 중위수 
    ##  중위수 =  3.925    분산 =  0.08514493

-   도수분포표에서 중위수를 구하기 위해서는 다음의 식을 이용하여 구한다.

$$
\\begin{aligned}
median = Lower\\space \\space limit \\space of \\space Interval + \\frac{0.5n-Cummulative \\space Frequency}{Num. of \\space observations \\space in \\space interval} \\cdot Interval \\space size
\\end{aligned}
$$
해당 데이터를 표로 작성하면 다음과 같다.

| *X*<sub>*i*</sub>(*c**m*) | *f*<sub>*i*</sub> | *f*<sub>*i*</sub>*X*<sub>*i*</sub>(*c**m*) |
|:-------------------------:|:-----------------:|:------------------------------------------:|
|            3.3            |         1         |                    3.3                     |
|            3.4            |         0         |                     0                      |
|            3.5            |         1         |                    3.5                     |
|            3.6            |         2         |                    7.2                     |
|            3.7            |         1         |                    3.7                     |
|            3.8            |         3         |                    11.4                    |
|            3.9            |         3         |                    11.7                    |
|            4.0            |         4         |                    16.0                    |
|            4.1            |         3         |                    12.3                    |
|            4.2            |         2         |                    8.4                     |
|            4.3            |         2         |                    8.6                     |
|            4.4            |         1         |                    4.4                     |
|            4.5            |         1         |                    4.5                     |
|            Sum            |        24         |                     95                     |

-   **1) 예상 구간의 하한값 **<br/>24개의 관측치 중 11개의 관측치는
    4.0cm 보다 작고 9개는 크다.<br/>그러므로 통상적인 중위수는 12번째
    값이 포함된 4.0 이라 하기는 어렵다.<br/>하지만 중위수는 \[3.95,
    4.05\] 이내에 있을 필요가 있다고 생각해야한다.<br/>따라서 예상구간의
    하한값은 3.95 가 된다.

-   **2) 총 빈도**

``` r
sum(fi)
```

    ## [1] 24

-   **3) 누적 빈도**<br/>누적빈도는 4.0이 오기 전 까지의 누적 빈도를
    사용한다.

``` r
which(fi==4.0) # 8번째 인덱스에 4.0 위치
```

    ## [1] 8

``` r
cf <- cumsum(fi)
cf[7] #7번째 인덱스 까지의 누적빈도
```

    ## [1] 11

-   **4) 구간 크기**

``` r
diff(xi) #0.1
```

    ##  [1] 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1

-   이렇게 구한 값들로 중위수를 구하면 다음과 같다.

$$
\\begin{aligned}
median =3.95\\space cm + \\frac{0.5\\cdot24-11}{4} \\cdot 0.1=3.95 \\space cm+0.025 \\space cm=3.975\\space cm
\\end{aligned}
$$

-   수식을 이용한 도수분포표에서의 중위수는 3.975로 나왔다.

-   **히스토그램**

``` r
library('ggplot2')
ggplot(ex3_1, aes(x=Length)) +  geom_histogram(binwidth = 0.1, fill='#8dd3c7',colour='#ffffb3')+
  scale_x_continuous(breaks = seq(0,4.5,0.1))
```

![](/study/img/ch3/unnamed-chunk-8-1.png)

-   히스토그램을 보면 날개의 길이가 4인 경우의 빈도수가 4로 가장
    많은것을 알 수 있다.
-   나비 날개 길이의 frequency table 출력 결과를 살펴보면 표본평균 값이
    3.96이고 중앙값이 3.975이므로 두 값이 서로 비슷한 것을 확인할 수
    있다. 따라서 거의 치우치지 않은 분포의 형태를 띄고 있는 것을 알 수
    있고 히스토그램을 통해서도 확인할 수 있다.

### EXAMPLE 3.3

![](/study/img/ch3/3-3.png)

``` r
#데이터셋
ex3_3
```

    ##    exam3_3.Group exam3_3.LifeSpan
    ## 1              A               16
    ## 2              A               32
    ## 3              A               37
    ## 4              A               39
    ## 5              A               40
    ## 6              A               41
    ## 7              A               42
    ## 8              A               50
    ## 9              A               82
    ## 10             B               34
    ## 11             B               36
    ## 12             B               38
    ## 13             B               45
    ## 14             B               50
    ## 15             B               54
    ## 16             B               56
    ## 17             B               59
    ## 18             B               69
    ## 19             B               91

``` r
ex3_3$exam3_3.LifeSpan
```

    ##  [1] 16 32 37 39 40 41 42 50 82 34 36 38 45 50 54 56 59 69 91

``` r
ex3_3_a <- subset(ex3_3,exam3_3.Group=="A")
ex3_3_b <- subset(ex3_3,exam3_3.Group=="B")
a_n <- length(ex3_3_a$exam3_3.Group) 
b_n <- length(ex3_3_b$exam3_3.Group)
a_med <- median(ex3_3_a$exam3_3.LifeSpan) 
b_med <- median(ex3_3_b$exam3_3.LifeSpan)
a_mn <- round(mean(ex3_3_a$exam3_3.LifeSpan),2) ;
b_mn <- mean(ex3_3_b$exam3_3.LifeSpan)

cat(" Number of Species A = ",a_n,",  Median of Species A = ",a_med, ",  Mean of Species A = ",a_mn,"\n",
    "Number of Species B = ",b_n,",  Median of Species B = ",b_med, ",  Mean of Species B = ",b_mn)
```

    ##  Number of Species A =  9 ,  Median of Species A =  40 ,  Mean of Species A =  42.11 
    ##  Number of Species B =  10 ,  Median of Species B =  52 ,  Mean of Species B =  53.2

|                    | Species *A* | Species *B* |
|:-------------------|:------------|:------------|
| *n*                | 9           | 10          |
| *m**e**d**i**a**n* | 40          | 52          |
| $\\overline X$     | 42.11       | 53.20       |

-   A종의 새 9마리와 B종의 새 10마리를 관측했을 때, A종의 경우 수명
    중위수는 40개월, 평균 수명은 42.11개월이며 B종의 경우 수명 중위수는
    52개월, 평균 수명은 53.20개월로 측정되었다.

### EXAMPLE 3.4

![](/study/img/ch3/3-4.png)

``` r
#데이터셋
ex3_4
```

    ##   exam3_4.decade exam3_4.population exam3_4.ratio
    ## 1              0              10000            NA
    ## 2              1              10500          1.05
    ## 3              2              11550          1.10
    ## 4              3              13860          1.20
    ## 5              4              18156          1.31

-   기하평균은 인구증가율 등을 구할 때 사용되는 평균이며 데이터가 같지
    않다면 기하평균은 산술평균보다 항상 작다는 특징이 있다.

$$\\bar{X_G} =
\\begin{cases}
Method \\ 1) ^n \\sqrt{X_1 X_2 X_3 \\cdots X_n} \\\\
Method \\ 2) antilog(\\frac{logX_1 + logX_2 + \\cdots + logX_n}{n}) \\\\
\\end{cases}
$$

-   Manually

``` r
x_bar <- mean(na.omit(ex3_4$exam3_4.ratio))
geo_mean_x_method1 <- exp(mean(log(na.omit(ex3_4$exam3_4.ratio)))) 
geo_mean_x_method2 <- prod(na.omit(ex3_4$exam3_4.ratio)) ^ (1/length(na.omit(ex3_4$exam3_4.ratio)))
cat('Geometric Mean Manually =', '('  ,'method1 =', geo_mean_x_method1, ',' ,'method2 =' ,geo_mean_x_method2,')')
```

    ## Geometric Mean Manually = ( method1 = 1.160803 , method2 = 1.160803 )

-   Package

``` r
library(psych)
geo_mean_x_package <- geometric.mean(ex3_4$exam3_4.ratio) ; cat('Geometric Mean with psych package =', geo_mean_x_package)
```

    ## Geometric Mean with psych package = 1.160803

-   기하 평균은 데이터 곱의 n 제곱근(Method 1)으로 나타낼 수
    있으며,<br/>데이터 로그 변환의 산술 평균을 다시 역로그변환(지수
    변환) (Method 2)으로 나타낼 수 있다.<br/>변화율의 산술 평균은
    1.165이며, 이 때 기하 평균은 두 가지 방법 및 패키지를 이용하였을 때
    1.1608로 동일하게 산출된다.

``` r
first_p <- ex3_4$exam3_4.population[1] # 초기 population
final_p_a  <- round(first_p*mean(ex3_4$exam3_4.ratio[2:5])^4)
final_p_g <- round(first_p*round(geometric.mean(ex3_4$exam3_4.ratio[2:5]),4)^4)
cat(" 산술평균으로 구한 Final Population = ",final_p_a,"\n","기하평균으로 구한 Final Population = ",final_p_g) 
```

    ##  산술평균으로 구한 Final Population =  18421 
    ##  기하평균으로 구한 Final Population =  18156

-   앞서 구한 산술평균과 기하평균을 이용해 마지막 인구집단 사이즈를
    구해보았다.

### EXAMPLE 3.5

![](/study/img/ch3/3-5.png)

``` r
#데이터셋
ex3_5
```

    ##    X
    ## 1 40
    ## 2 20

-   조화평균은 평균의 변화율을 구할 떄 주로 사용되며 데이터가 양수이고
    비척도인 경우에 이용한다.
    $$
    \\bar{X_H} = \\frac{n}{\\sum \\frac{1}{X_i}}
    $$
-   Manually

``` r
harmonic_mean_manual <- round(length(ex3_5$X) / sum(1/ex3_5$X),2) ; cat('Harmonic Mean Manually =', harmonic_mean_manual)
```

    ## Harmonic Mean Manually = 26.67

-   Package

``` r
library(psych)
harmonic_mean_package <- round(harmonic.mean(ex3_5$X),2) ; cat('Harmonic Mean with psych package =', harmonic_mean_package)
```

    ## Harmonic Mean with psych package = 26.67

-   수식을 이용한 방식과 패키지를 이용하여 조화 평균을 산출 했을 때 값이
    26.67로 같은 값이 산출된다.

``` r
xm <- mean(ex3_5$X)
cat("산술평균=", xm, "km/h,   조화평균=",harmonic_mean_manual,"km/h")
```

    ## 산술평균= 30 km/h,   조화평균= 26.67 km/h

-   이처럼 전체 거리를 절반은40km/h로 달리고 나머지는 20km/h로 달렸다면,
    평균속력은 40과 20의 조화평균인 26.67 km/h가 된다.

### EXAMPLE 3.6

![](/study/img/ch3/3-6.png)

``` r
#데이터셋
ex3_6
```

    ##   exam3_6.X1 exam3_6.code1 exam3_6.X2 exam3_6.code2
    ## 1        842             2       8000          8000
    ## 2        844             4       9000          9000
    ## 3        846             6      95000         95000
    ## 4        846             6      11000         11000
    ## 5        847             7      12500         12500
    ## 6        848             8      13000         13000
    ## 7        849             9         NA            NA

``` r
A <- -840 ; M <- 0.001

sum_sample1 <- sum(ex3_6$exam3_6.X1)
coded_sum_sample1 <- sum(ex3_6$exam3_6.code1)
mean_sample1 <- mean(ex3_6$exam3_6.X1)
coded_mean_sample1 <- mean(ex3_6$exam3_6.code1)

mean_sample1 <-  coded_mean_sample1-A
mean_sample1
```

    ## [1] 846

The mean of the coded values is equal to *X̄* − 840*g*.

``` r
#데이터 오기 수정하기
ex3_6$exam3_6.X2[3] <- ex3_6$exam3_6.X2[3]/10
ex3_6$exam3_6.code2[3] <- ex3_6$exam3_6.code2[3]/10

#결측값제외하고 계산
sum_sample2 <- sum(na.omit(ex3_6$exam3_6.X2))
coded_sum_sample2 <- sum(na.omit(ex3_6$exam3_6.code2*M))
mean_sample2 <- mean(na.omit(ex3_6$exam3_6.X2))
coded_mean_sample2 <- mean(na.omit(ex3_6$exam3_6.code2*M))

mean_sample2 <-  coded_mean_sample2 / M
mean_sample2
```

    ## [1] 10500

The mean of the coded values is equal to *X̄* \* *M*.

| stat / Group | Sample 1 | Sample 2 |
|--------------|----------|----------|
| Sum          | 5922     | 63000    |
| coded Sum    | 42       | 63       |
| Mean         | 846      | 10500    |
| coded Mean   | 6        | 10.5     |<br/>
<br/>




<font color='#fb8072'>교재: Biostatistical Analysis (5th Edition) by Jerrold H. Zar (z-lib.org)</font><br/>

<font color='#fb8072'> **이 글은 22학년도 1학기 의학통계방법론 과제 자료들을 정리한 글입니다.** </font>