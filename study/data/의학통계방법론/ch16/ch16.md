## 16장

**16장 연습문제 불러오기**

``` r
ex16_1 <- read.spss('Exam 16.1.sav', to.data.frame=T)
```

## EXAMPLE 16.1

![](/study/img/의학통계방법론/ch16/16-1.png)

``` r
#데이터셋
ex16_1%>%
  kbl(caption = "Dataset",escape=F) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Dataset
</caption>
<thead>
<tr>
<th style="text-align:right;">
Y11
</th>
<th style="text-align:right;">
Y12
</th>
<th style="text-align:right;">
Y21
</th>
<th style="text-align:right;">
Y22
</th>
<th style="text-align:right;">
Y31
</th>
<th style="text-align:right;">
Y32
</th>
<th style="text-align:right;">
Y41
</th>
<th style="text-align:right;">
Y42
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
4.57
</td>
<td style="text-align:right;">
4.35
</td>
<td style="text-align:right;">
5.30
</td>
<td style="text-align:right;">
3.98
</td>
<td style="text-align:right;">
5.05
</td>
<td style="text-align:right;">
1.98
</td>
<td style="text-align:right;">
4.19
</td>
</tr>
<tr>
<td style="text-align:right;">
2.52
</td>
<td style="text-align:right;">
4.11
</td>
<td style="text-align:right;">
4.41
</td>
<td style="text-align:right;">
5.61
</td>
<td style="text-align:right;">
3.48
</td>
<td style="text-align:right;">
5.09
</td>
<td style="text-align:right;">
2.05
</td>
<td style="text-align:right;">
3.81
</td>
</tr>
<tr>
<td style="text-align:right;">
2.61
</td>
<td style="text-align:right;">
4.79
</td>
<td style="text-align:right;">
4.38
</td>
<td style="text-align:right;">
5.83
</td>
<td style="text-align:right;">
3.36
</td>
<td style="text-align:right;">
4.95
</td>
<td style="text-align:right;">
2.17
</td>
<td style="text-align:right;">
4.33
</td>
</tr>
<tr>
<td style="text-align:right;">
2.42
</td>
<td style="text-align:right;">
4.35
</td>
<td style="text-align:right;">
4.51
</td>
<td style="text-align:right;">
5.75
</td>
<td style="text-align:right;">
3.52
</td>
<td style="text-align:right;">
4.90
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
3.70
</td>
</tr>
<tr>
<td style="text-align:right;">
2.51
</td>
<td style="text-align:right;">
4.36
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3.41
</td>
<td style="text-align:right;">
5.38
</td>
<td style="text-align:right;">
2.02
</td>
<td style="text-align:right;">
4.06
</td>
</tr>
</tbody>
</table>

- 분석을 위하여 데이터를 정제하도록 하겠다.

``` r
month <- c(rep("December",5),rep("January",5),rep("February",5),rep("March",5))

fat <- c(ex16_1$Y11,ex16_1$Y21,ex16_1$Y31,ex16_1$Y41) 

lean <- c(ex16_1$Y12,ex16_1$Y22,ex16_1$Y32,ex16_1$Y42)

ex16 <- data.frame(month,fat,lean)

ex16%>%
  kbl(caption = "Dataset of Example 16.1") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Dataset of Example 16.1
</caption>
<thead>
<tr>
<th style="text-align:left;">
month
</th>
<th style="text-align:right;">
fat
</th>
<th style="text-align:right;">
lean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
December
</td>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
4.57
</td>
</tr>
<tr>
<td style="text-align:left;">
December
</td>
<td style="text-align:right;">
2.52
</td>
<td style="text-align:right;">
4.11
</td>
</tr>
<tr>
<td style="text-align:left;">
December
</td>
<td style="text-align:right;">
2.61
</td>
<td style="text-align:right;">
4.79
</td>
</tr>
<tr>
<td style="text-align:left;">
December
</td>
<td style="text-align:right;">
2.42
</td>
<td style="text-align:right;">
4.35
</td>
</tr>
<tr>
<td style="text-align:left;">
December
</td>
<td style="text-align:right;">
2.51
</td>
<td style="text-align:right;">
4.36
</td>
</tr>
<tr>
<td style="text-align:left;">
January
</td>
<td style="text-align:right;">
4.35
</td>
<td style="text-align:right;">
5.30
</td>
</tr>
<tr>
<td style="text-align:left;">
January
</td>
<td style="text-align:right;">
4.41
</td>
<td style="text-align:right;">
5.61
</td>
</tr>
<tr>
<td style="text-align:left;">
January
</td>
<td style="text-align:right;">
4.38
</td>
<td style="text-align:right;">
5.83
</td>
</tr>
<tr>
<td style="text-align:left;">
January
</td>
<td style="text-align:right;">
4.51
</td>
<td style="text-align:right;">
5.75
</td>
</tr>
<tr>
<td style="text-align:left;">
January
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
February
</td>
<td style="text-align:right;">
3.98
</td>
<td style="text-align:right;">
5.05
</td>
</tr>
<tr>
<td style="text-align:left;">
February
</td>
<td style="text-align:right;">
3.48
</td>
<td style="text-align:right;">
5.09
</td>
</tr>
<tr>
<td style="text-align:left;">
February
</td>
<td style="text-align:right;">
3.36
</td>
<td style="text-align:right;">
4.95
</td>
</tr>
<tr>
<td style="text-align:left;">
February
</td>
<td style="text-align:right;">
3.52
</td>
<td style="text-align:right;">
4.90
</td>
</tr>
<tr>
<td style="text-align:left;">
February
</td>
<td style="text-align:right;">
3.41
</td>
<td style="text-align:right;">
5.38
</td>
</tr>
<tr>
<td style="text-align:left;">
March
</td>
<td style="text-align:right;">
1.98
</td>
<td style="text-align:right;">
4.19
</td>
</tr>
<tr>
<td style="text-align:left;">
March
</td>
<td style="text-align:right;">
2.05
</td>
<td style="text-align:right;">
3.81
</td>
</tr>
<tr>
<td style="text-align:left;">
March
</td>
<td style="text-align:right;">
2.17
</td>
<td style="text-align:right;">
4.33
</td>
</tr>
<tr>
<td style="text-align:left;">
March
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
3.70
</td>
</tr>
<tr>
<td style="text-align:left;">
March
</td>
<td style="text-align:right;">
2.02
</td>
<td style="text-align:right;">
4.06
</td>
</tr>
</tbody>
</table>

- 해당 데이터는 참새들의 지방 함량를 측정한 데이터로 같은 장소에서 4번씩 12월, 1월, 2월, 3월 이렇게 측정되었으며 지방에 따라 Fat weight와 Lean dry weight로 나뉜뉜 데이터이다.<br/>
- 이 데이터를 사용하여 그룹별로 지방 함량의 평균이 같은지 알아보기 위해 다변량 분산분석을 시행해보고자 한다.<br/><br/>
- 본 검정의 가설은 다음과 같다.

$$
\begin{aligned}
H_0 &: \mu_{11}=\mu_{12}=\mu_{13}=\mu_{14} \ and \ \mu_{21}=\mu_{22}=\mu_{23}=\mu_{24} \\
H_1 &: \ Sparrows \ do \ not \ have \ the \ same \ weight \ of \ fat \ and \ the \ same \ weight \ of \ fat-free \ dry \ body \ tissue \ at \ these \ four \ times \ of \ the \ year.
\end{aligned}
$$

* 우선 반복측정자료분석에서의 가정 (다변량적 접근)을 살펴보겠다.<br/><br/>
  - 종속변수들의 상관성<br/>
  - 다변량 정규성 (multivariate normality)<br/>
    - 종속변수들은 다변량 정규분포를 따른다.<br/>
    - 종속변수들의 선형조합도 정규분포를 따른다.<br/>
  - 분산-공분산 행렬의 동질성 (homogeneity)<br/>
    - MANOVA는 그룹내 분산-공분산 행렬이 동일하다고 가정한다.<br/>
    - 분산-공분산 행렬의 동질성은 Box의 M-test를 이용하여 확인한다.<br/>
  - 선형성 (linearity): 종속변수들과 독립변수들 간 선형성<br/>
  - 관측 벡터의 독립성 (independence): 각 개체들은 서로 독립<br/>
  - 임의 표본 (random sampling)
<br/>
<br/>
* 다음은은 MANOVA에 대한 검정통계량을 살펴보겠다. <br/><br/>
  - Wilks' lambda (윌크스의 람다)<br/>
    - 0과 1사이의 값으로 산출되며, 처리효과가 있을수록 값이 작아진다.
    - 만약 그룹 간 효과와 관련된 B(between)가 커지면 윌크스의 람다 값은 0에 가까워지고 만약 작아지면 1에 가까워진다.<br/>$$ \Lambda=\frac{\mid W \mid }{\mid B+W \mid}=\frac{\mid W \mid}{\mid T \mid}=\prod_{i=1}^{q}\frac{1}{1+\lambda_i} \\ 
\\
where \ W \ and \ T \ are \ determinants \ of \ the \ within \ and \ total \ sum \ of \ squares \ and \ cross-product \ matrices
$$<br/>
  - Phillai's trace (필라이 대각합)
    - 양수의 값을 가지며, 처리효과가 클수록 값이 커진다.<br/>$$
trace[B(B+W)^{-1}]=\sum_{i=1}^{q}\frac{\lambda_i}{1+\lambda_i}
$$<br/>
  - Lawley-Hotelling trace (로리-호텔링의 대각합)
    - 양수의 값을 가지며, 효과가 있으면 값이 커진다.<br/>$$
trace[BW^{-1}]=\sum_{i=1}^{q}\lambda_i
$$<br/>
  - Roy's maximum root (로이의 최대근)
    - 양수의 값을 가지며, 효과가 있을수록 값이 커진다.<br/>$$
max(\lambda_i)
$$<br/><br/>
- 데이터에 이상치가 존재하는지 확인하도록 하겠다.

``` r
library("mvoutlier")
aq.plot(na.omit(ex16[,2:3]),alpha=0.05)
```

![](/study/img/의학통계방법론/ch16/unnamed-chunk-5-1.png)

    ## $outliers
    ##     1     2     3     4     5     6     7     8     9    11    12    13    14 
    ## FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE 
    ##    15    16    17    18    19    20 
    ## FALSE FALSE FALSE FALSE FALSE FALSE

- 이상치가 없는 것으로 확인되며, 그룹별로 정규성을 따르는지 확인하도록 하겠다.

> 다변량 정규성 검정

``` r
library("mvnormtest") # mshapiro.test
library("broom") # tidy
mshapiro.test(t(ex16[1:5,2:3])) %>% tidy %>% 
  kable(,caption = "Normality test (December)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Normality test (December)
</caption>
<thead>
<tr>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.79349
</td>
<td style="text-align:right;">
0.0716398
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
</tbody>
</table>

``` r
mshapiro.test(t(na.omit(ex16[6:10,2:3]))) %>% tidy %>% 
  kable(,caption = "Normality test (January)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Normality test (January)
</caption>
<thead>
<tr>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.8272233
</td>
<td style="text-align:right;">
0.1606765
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
</tbody>
</table>

``` r
mshapiro.test(t(ex16[11:15,2:3])) %>% tidy %>% 
  kable(,caption = "Normality test (February)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Normality test (February)
</caption>
<thead>
<tr>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.7764365
</td>
<td style="text-align:right;">
0.0513539
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
</tbody>
</table>

``` r
mshapiro.test(t(ex16[16:20,2:3])) %>% tidy %>% 
  kable(,caption = "Normality test (March)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Normality test (March)
</caption>
<thead>
<tr>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.7946881
</td>
<td style="text-align:right;">
0.0732947
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
</tbody>
</table>

- 정규성 검정 결과 모든 p-value는 유의수준 0.05보다 크므로 정규성을 따른다는 귀무가설을 기각할 충한 근거가 없다. <br/>
그러므로 해당 데이터는 그룹별로 정규성을 따른다고 하겠다.<br/><br/>
- 다음으로는 월 별로 공분산 행렬을 계산하여 보고, 공분산 행렬이 동질적인지 Box's M test를 수행하도록 하겠다.

> 분산-공분산행렬 동질성 검정

``` r
ex16_na <- na.omit(ex16)
covm <- by(ex16_na[,2:3], ex16_na$month, cov)

covm$December %>% 
  kable(caption = "Covariance Matrices by December") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Covariance Matrices by December
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fat
</th>
<th style="text-align:right;">
lean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fat
</td>
<td style="text-align:right;">
0.00673
</td>
<td style="text-align:right;">
0.00662
</td>
</tr>
<tr>
<td style="text-align:left;">
lean
</td>
<td style="text-align:right;">
0.00662
</td>
<td style="text-align:right;">
0.06568
</td>
</tr>
</tbody>
</table>

``` r
covm$January %>% 
  kable(caption = "Covariance Matrices by January") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Covariance Matrices by January
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fat
</th>
<th style="text-align:right;">
lean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fat
</td>
<td style="text-align:right;">
0.004825
</td>
<td style="text-align:right;">
0.0086250
</td>
</tr>
<tr>
<td style="text-align:left;">
lean
</td>
<td style="text-align:right;">
0.008625
</td>
<td style="text-align:right;">
0.0544917
</td>
</tr>
</tbody>
</table>

``` r
covm$February %>% 
  kable(caption = "Covariance Matrices by February") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Covariance Matrices by February
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fat
</th>
<th style="text-align:right;">
lean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fat
</td>
<td style="text-align:right;">
0.061600
</td>
<td style="text-align:right;">
-0.006375
</td>
</tr>
<tr>
<td style="text-align:left;">
lean
</td>
<td style="text-align:right;">
-0.006375
</td>
<td style="text-align:right;">
0.035030
</td>
</tr>
</tbody>
</table>

``` r
covm$March %>% 
  kable(caption = "Covariance Matrices by March") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Covariance Matrices by March
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
fat
</th>
<th style="text-align:right;">
lean
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fat
</td>
<td style="text-align:right;">
0.00563
</td>
<td style="text-align:right;">
0.01001
</td>
</tr>
<tr>
<td style="text-align:left;">
lean
</td>
<td style="text-align:right;">
0.01001
</td>
<td style="text-align:right;">
0.06827
</td>
</tr>
</tbody>
</table>

``` r
library("biotools") # boxM

boxM(ex16_na[,2:3], ex16_na$month) %>% tidy %>% 
  rename("Chi-sq statistic"="statistic","df"="parameter") %>% 
  kable(caption = "Homogeneity of Covariance Matrices") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Homogeneity of Covariance Matrices
</caption>
<thead>
<tr>
<th style="text-align:right;">
Chi-sq statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
9.559461
</td>
<td style="text-align:right;">
0.3873108
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Box’s M-test for Homogeneity of Covariance Matrices
</td>
</tr>
</tbody>
</table>

- Box’s M test의 결과 p-value=0.387로써 유의수준 5%하에 귀무가설을 기각하지 못한다.<br/>
- 따라서 그룹간 공분산 행렬이 동일하지 않다는 충분한 근거가 없으며, 구형성을 만족한다고 할 수 있다.<br/><br/>
- 이제 위에서 소개했던 MANOVA에 대한 검정통계량을 적용하여 보겠다.

``` r
anov <- manova(cbind(fat,lean)~month, data=ex16_na)

tidy(anov,  test = "Wilks") %>% 
  rename("Wilk's Lambda"="wilks","F value"="statistic") %>% 
  kable(caption = "MANOVA using Wilk's Lambda",booktabs = TRUE, valign = 't') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
MANOVA using Wilk’s Lambda
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
Wilk’s Lambda
</th>
<th style="text-align:right;">
F value
</th>
<th style="text-align:right;">
num.df
</th>
<th style="text-align:right;">
den.df
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
month
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0177815
</td>
<td style="text-align:right;">
30.32966
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>

``` r
tidy(anov) %>% rename("Pillai's trace"="pillai","F value"="statistic") %>% 
  kable(caption = "MANOVA using Pillai's trace",booktabs = TRUE, valign = 't') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
MANOVA using Pillai’s trace
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
Pillai’s trace
</th>
<th style="text-align:right;">
F value
</th>
<th style="text-align:right;">
num.df
</th>
<th style="text-align:right;">
den.df
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
month
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.02229
</td>
<td style="text-align:right;">
5.227982
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.0008709
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>

``` r
tidy(anov,  test = "Hotelling") %>% rename("Hotelling-Lawley trace"="hl","F value"="statistic") %>% 
  kable(caption = "MANOVA using Hotelling-Lawley trace",booktabs = TRUE, valign = 't') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
MANOVA using Hotelling-Lawley trace
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
Hotelling-Lawley trace
</th>
<th style="text-align:right;">
F value
</th>
<th style="text-align:right;">
num.df
</th>
<th style="text-align:right;">
den.df
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
month
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
52.98465
</td>
<td style="text-align:right;">
114.8001
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>

``` r
tidy(anov,  test = "Roy") %>% rename("Roy's maximum root"="roy","F value"="statistic") %>% 
  kable(caption = "MANOVA using Roy's maximum root",booktabs = TRUE, valign = 't') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
MANOVA using Roy’s maximum root
</caption>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
df
</th>
<th style="text-align:right;">
Roy’s maximum root
</th>
<th style="text-align:right;">
F value
</th>
<th style="text-align:right;">
num.df
</th>
<th style="text-align:right;">
den.df
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
month
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
52.94209
</td>
<td style="text-align:right;">
264.7104
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Residuals
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>

- 4가지 방법 모두 p-value가 유의수준 0.05보다 작은 값을 가지는 것을 볼 수 있다. <br/>
- 따라서 월별 모든 참새들의 fat weight와 lean dry weight가 다르다고 할 수 있다. <br/><br/>
- 다변량 분산분석의 사후분석을 하기 위해 판별함수 분석을 수행하여 종속변수들이 그룹을 어떻게 분리하는지 파악하도록 하겠다.

> 사후분석

``` r
dfa <- lda(month~fat+lean,data=ex16_na)
dfa
```

    ## Call:
    ## lda(month ~ fat + lean, data = ex16_na)
    ## 
    ## Prior probabilities of groups:
    ##  December  February   January     March 
    ## 0.2631579 0.2631579 0.2105263 0.2631579 
    ## 
    ## Group means:
    ##             fat   lean
    ## December 2.4940 4.4360
    ## February 3.5500 5.0740
    ## January  4.4125 5.6225
    ## March    2.0440 4.0180
    ## 
    ## Coefficients of linear discriminants:
    ##           LD1      LD2
    ## fat  6.461863  2.72530
    ## lean 1.127769 -4.11224
    ## 
    ## Proportion of trace:
    ##    LD1    LD2 
    ## 0.9992 0.0008

- Prior probabilities of groups를 보면 4개의 월별 모두 표본 크기가 같으므로 사전확률도 0.2631579로 같다.<br/>
- 첫번쨰 판별함수 LD1의 열을 보면 fat weight 와 lean dry weight의 효과를 같은 방향으로 구분한다.<br/>
- 두번쨰 판별함수 LD2의 열을 보면 fat weight 와 lean dry weight의 효과를 반대 방향으로 구분한다.<br/>
- Proportion of trace를 보면 LD1은 전체 변동의 99.92%를, LD2는 전체 변동의 0.08%를 설명한다.<br/><br/>
- 마지막으로 판별점수를 가지고 산점도를 그려 시각화하여 보겠다.

``` r
lda_df <- data.frame(
  month = ex16_na[, "month"],
  lda = predict(dfa)$x
)

library("ggplot2")
ggplot(lda_df) +
  geom_point(aes(x = lda.LD1, y = lda.LD2, color = month), size = 4) +
  theme_classic()
```

![](/study/img/의학통계방법론/ch16/unnamed-chunk-11-1.png)

- 그래프를 보면 December과 March일 때의 판별점수가 February와 January와 확실히 significant하게 다름을 볼 수 있다.<br/>
- December일 때와 March일 때가 매우 비슷하며 January 그룹에서 그룹별 지방함량의 평균이 같다는 귀무가설을 기각할 충분한 근거가 있는 효과 크기를 가지고 있다고 볼 수 있다.
